from django.shortcuts import render, redirect
from django.contrib.auth.models import User
from django.contrib.auth import authenticate, login
from django.contrib import messages
from store.models import Product


# ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (ØªØ¸Ù‡Ø± Ø¢Ø®Ø± 4 Ù…Ù†ØªØ¬Ø§Øª)
def home(request):
    latest_products = Product.objects.all()[:4]  # Ø¬Ù„Ø¨ Ø¢Ø®Ø± 4 Ù…Ù†ØªØ¬Ø§Øª ÙÙ‚Ø·
    return render(request, 'core/home.html', {'latest_products': latest_products})


# ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
def login_view(request):
    if request.method == "POST":
        username = request.POST.get("username")
        password = request.POST.get("password")

        user = authenticate(request, username=username, password=password)
        if user is not None:
            login(request, user)
            messages.success(request, f"Ù…Ø±Ø­Ø¨Ø§Ù‹ {username} ğŸ°")
            return redirect("home")
        else:
            messages.error(request, "âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©")
            return redirect("login")

    return render(request, "core/login.html")


# ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
def register_view(request):
    if request.method == "POST":
        username = request.POST.get("username")
        email = request.POST.get("email")
        password = request.POST.get("password")

        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹
        if User.objects.filter(username=username).exists():
            messages.error(request, "âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹")
            return redirect("register")

        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
        User.objects.create_user(username=username, email=email, password=password)
        messages.success(request, "ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.")
        return redirect("login")

    return render(request, "core/register.html")


# ğŸ“ ØµÙØ­Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§
def contact(request):
    return render(request, "core/contact.html")
